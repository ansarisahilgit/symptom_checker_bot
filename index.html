<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Medical Chatbot â€” Symptom Checker</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    .chat-container {
      display: flex;
      flex-direction: column;
      height: 70vh;
      max-height: 600px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: var(--card);
    }
    
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    .message {
      max-width: 80%;
      padding: 0.75rem 1rem;
      border-radius: 18px;
      line-height: 1.4;
      position: relative;
    }
    
    .user-message {
      align-self: flex-end;
      background: var(--primary);
      color: white;
      border-bottom-right-radius: 4px;
    }
    
    .bot-message {
      align-self: flex-start;
      background: #f1f5f9;
      color: var(--text);
      border-bottom-left-radius: 4px;
      border: 1px solid var(--border);
    }
    
    .message-time {
      font-size: 0.7rem;
      opacity: 0.7;
      margin-top: 0.25rem;
    }
    
    .chat-input-container {
      padding: 1rem;
      border-top: 1px solid var(--border);
      background: var(--card);
    }
    
    .chat-input-row {
      display: flex;
      gap: 0.5rem;
    }
    
    .chat-input {
      flex: 1;
      padding: 0.75rem;
      border: 1px solid var(--border);
      border-radius: 24px;
      resize: none;
      font-family: inherit;
      font-size: 0.9rem;
    }
    
    .send-btn {
      padding: 0.75rem 1.5rem;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 24px;
      cursor: pointer;
      font-weight: 500;
    }
    
    .send-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .typing-indicator {
      display: none;
      align-self: flex-start;
      background: #f1f5f9;
      padding: 0.75rem 1rem;
      border-radius: 18px;
      border-bottom-left-radius: 4px;
      color: var(--muted);
      font-style: italic;
    }
    
    .welcome-message {
      text-align: center;
      padding: 2rem;
      color: var(--muted);
    }
    
    .quick-symptoms {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 1rem;
      justify-content: center;
    }
    
    .symptom-chip {
      padding: 0.4rem 0.8rem;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .symptom-chip:hover {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }
    
    .analysis-results {
      margin-top: 1rem;
      border-top: 1px solid var(--border);
      padding-top: 1rem;
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="app-header">
      <div class="brand">
        <svg class="logo" width="44" height="44" viewBox="0 0 24 24" fill="none" aria-hidden>
          <path d="M12 2l7 3v5c0 5-3 9-7 12-4-3-7-7-7-12V5l7-3z" fill="#2B7CFF" opacity="0.12"/>
          <path d="M12 3.2l6 2.57v4.2c0 4.2-2.5 7.5-6 10-3.5-2.5-6-5.8-6-10V5.77L12 3.2z" fill="#2B7CFF"/>
          <path d="M12 8.5c.83-1.1 2.2-1.6 3.4-1.4 1.9.28 3.1 2.4 2 4.3-1.3 2.2-4.1 4.4-5.4 5.3-.3.2-.7.2-1 0-1.3-.9-4.1-3.1-5.4-5.3-1.1-1.9.1-4 2-4.3 1.2-.2 2.6.3 3.4 1.4" fill="#fff"/>
        </svg>
        <div>
          <h1>Medical Chatbot</h1>
          <p class="team">Symptom Checker & Health Assistant</p>
        </div>
      </div>

      <div class="header-actions">
        <a class="btn small" href="/history">View History</a>
      </div>
    </header>

    <main class="container">
      <!-- API Status Alert -->
      <div id="apiStatusAlert" class="alert alert-warning hidden">
        <strong>Note:</strong> DeepSeek API is currently unavailable. Using mock data for demonstration.
      </div>

      <!-- Patient Info Card -->
      <div class="card form-card">
        <h3>Patient Information</h3>
        <div class="grid-row">
          <label>
            Age
            <input type="number" id="age" name="age" min="0" max="120" placeholder="25">
          </label>
          <label>
            Gender
            <select id="gender" name="gender">
              <option value="">Prefer not to say</option>
              <option value="male">Male</option>
              <option value="female">Female</option>
              <option value="other">Other</option>
            </select>
          </label>
          <label>
            Patient Name
            <input type="text" id="patient_name" name="patient_name" placeholder="Optional">
          </label>
        </div>
      </div>

      <!-- Chat Interface -->
      <div class="card">
        <h3>Chat with Medical Assistant</h3>
        <div class="chat-container">
          <div class="chat-messages" id="chatMessages">
            <div class="welcome-message">
              <p>ðŸ‘‹ Hello! I'm your medical assistant. I can help you understand your symptoms and provide guidance.</p>
              <p><strong>How can I help you today?</strong></p>
              
              <div class="quick-symptoms">
                <div class="symptom-chip" data-symptom="fever and cough">Fever & Cough</div>
                <div class="symptom-chip" data-symptom="headache and nausea">Headache & Nausea</div>
                <div class="symptom-chip" data-symptom="sore throat and runny nose">Sore Throat</div>
                <div class="symptom-chip" data-symptom="stomach pain and diarrhea">Stomach Issues</div>
                <div class="symptom-chip" data-symptom="chest pain and dizziness">Chest Pain</div>
              </div>
            </div>
          </div>
          
          <div class="typing-indicator" id="typingIndicator">
            Medical Assistant is typing...
          </div>
          
          <div class="chat-input-container">
            <div class="chat-input-row">
              <textarea 
                id="chatInput" 
                class="chat-input" 
                placeholder="Describe your symptoms (e.g., I have fever and headache since yesterday)..."
                rows="1"
              ></textarea>
              <button id="sendButton" class="send-btn" disabled>
                Send
              </button>
            </div>
            <small class="muted note">ðŸ’¡ Be specific about symptoms, duration, and severity</small>
          </div>
        </div>
      </div>

      <!-- Analysis Results (initially hidden) -->
      <div id="analysisResults" class="analysis-results hidden">
        <!-- Results will be inserted here by JavaScript -->
      </div>

      <div id="loadingOverlay" class="loading-overlay hidden" aria-hidden="true">
        <div class="spinner" role="status" aria-label="Loading"></div>
        <div class="loading-text">Analyzing your symptoms...</div>
      </div>

      <div id="toast" class="toast hidden"></div>
    </main>

    <footer class="app-footer">
      <div class="footer-content">
        <small>ðŸ©º Medical Chatbot Prototype â€” For demonstration purposes only</small>
        <small class="disclaimer">This tool provides suggestions only and is not a medical diagnosis. Always consult with a healthcare professional for medical advice.</small>
      </div>
    </footer>
  </div>

  <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>