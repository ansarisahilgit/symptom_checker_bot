<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Conversation History - Medical Chatbot</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    .conversation-message {
      margin: 1rem 0;
      padding: 1rem;
      border-radius: 8px;
    }
    .user-message {
      background: #e3f2fd;
      margin-left: 2rem;
    }
    .bot-message {
      background: #f5f5f5;
      margin-right: 2rem;
    }
    .message-time {
      font-size: 0.8rem;
      color: #666;
      margin-top: 0.5rem;
    }
    .analysis-result {
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 1rem;
      margin: 1rem 0;
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="app-header">
      <div class="brand">
        <h1>Medical Chatbot</h1>
        <p class="team">Conversation History</p>
      </div>
      <div class="header-actions">
        <a class="btn small" href="/history">Back to History</a>
        <a class="btn small" href="/">New Chat</a>
      </div>
    </header>

    <main class="container">
      <div class="card">
        <h2>Conversation Session #{{ session_id }}</h2>
        
        <div class="conversation-history">
          {% if conversation.messages %}
            {% for message in conversation.messages %}
              <div class="conversation-message {{ 'user-message' if message.role == 'user' else 'bot-message' }}">
                <strong>{{ 'You' if message.role == 'user' else 'Medical Assistant' }}:</strong>
                <p>{{ message.content }}</p>
                <div class="message-time">{{ message.timestamp }}</div>
              </div>
            {% endfor %}
          {% else %}
            <p>No messages found for this session.</p>
          {% endif %}
        </div>

        {% if conversation.analyses %}
        <div class="analysis-section">
          <h3>Medical Analyses</h3>
          {% for analysis in conversation.analyses %}
            <div class="analysis-result">
              <h4>Analysis ({{ analysis.api_name }}) - {{ analysis.timestamp }}</h4>
              <p><strong>Triage:</strong> {{ analysis.result.triage }}</p>
              <p><strong>Summary:</strong> {{ analysis.result.summary }}</p>
              
              {% if analysis.result.conditions %}
              <div class="conditions">
                <strong>Possible Conditions:</strong>
                <ul>
                  {% for condition in analysis.result.conditions %}
                    <li>{{ condition.name }} ({{ (condition.probability * 100)|round }}%)</li>
                  {% endfor %}
                </ul>
              </div>
              {% endif %}
            </div>
          {% endfor %}
        </div>
        {% endif %}
      </div>
    </main>
  </div>
</body>
</html>